<script>
  var selected_keywords = [];
  function select_keyword(elem, name, message_name) {
      var email_content = $(elem).closest('.email_content');
    $('.reply_creation_area').addClass('modal');
    if (selected_keywords.indexOf(name) >= 0) {
      i = selected_keywords.indexOf(name);
      $('.suggested_'+name).removeClass('selected');
      $(email_content).find('input[name="reply[keywords]"]').tagsinput('remove', name);
      selected_keywords.splice(i,i+1);
    } else {
      $('.suggested_'+name).addClass('selected');
      selected_keywords.push(name);
      $("#" + message_name + " .reply_box .bootstrap-tagsinput input").val(name);
      $("#" + message_name + " .reply_box .bootstrap-tagsinput input").keypress();
    }
    if (selected_keywords.length > 0) {
      $(".submit-keywords").val("Write Replies");
      $("#" + message_name + " .reply_box").show();
    } else {
      $(".submit-keywords").val("Yup, these sure are emails.")
      $("#" + message_name + " .reply_box").hide();
    }
    $('.selected_keywords').val(selected_keywords);

  }

  $('input[name="reply[keywords]"]').on('itemRemoved', function(event) {
      var name = event.item;
      $(this).closest('.email_content')
          .find('.potential_keyword.suggested_'+name)
          .removeClass('selected');

      var i = selected_keywords.indexOf(name);
      selected_keywords.splice(i,i+1);
      $('.selected_keywords').val(selected_keywords);
  });
</script>
<% if controller_name == "wizard" %>
  <%= form_with(model: @emailaccount, url: "/wizard/3/#{@emailaccount.id}", method: "post", data: {remote: false}) do %>
    <input type="hidden" name="keywords" class="selected_keywords" value="">
    <input type="submit" value="Looks Good!" class="submit-keywords button button-large button-rounded button-connect text-white">
  <% end %>
<% end %>
<style>
  .email_body { color: #CCC; }
  .potential_keyword { color: #000; }
  .potential_keyword:hover { background: #00A8FF; }
</style>