$('span.last-check').text('<%= last_checked_at(@emailaccount) %>');

$('a.check_btn')
    .html('<i class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></i> Queued for next check...')
    .addClass('disabled')
    .attr('disabled', 'disabled');

var checkInterval = setInterval(function() {

    $.ajax({
        url: "<%= status_emailaccount_path(@emailaccount, :format => :json) %>",
        type: "GET",
        contentType: "application/json",
        success: function(data){
            if(data.data != null){

                $('span.last-check').text(data.data);

                clearInterval(checkInterval);

                var attr = $('a.check_btn').attr('disabled');
                if (typeof attr !== typeof undefined && attr !== false) {
                    $('a.check_btn').text('Check Again Now')
                        .removeClass('disabled')
                        .removeAttr('disabled');
                }
            }
        }
    });
}, 15000);

$('.debug_option').show();