$.magnificPopup.open({
    items: {
        src: "<%= j render 'new', paymentmethod: @paymentmethod %>", // can be a HTML string, jQuery object, or CSS selector
        type: 'inline'
    },
    modal: true,
    prependTo: $('.modals')
});

$('.button_cancel').on('click', function (e) {
  e.preventDefault();
  $.magnificPopup.close();
  return false;
});

$('#card_number').payment('formatCardNumber');
$('#card_expiration').payment('formatCardExpiry');
$('#card_cvc').payment('formatCardCVC');

Paymentmethod.set_submit();